{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/Desktop/app/Chat_application/ChatApplication/frontend/src/pages/Chat.jsx\",\n  _s = $RefreshSig$();\n// office-chat-frontend/src/components/Chat.js\n\nimport React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';\nimport io from 'socket.io-client';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport './Chat.css';\nimport AdminRegisterModal from './AdminRegisterModal';\nimport UserManagement from './UserManagement';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:5000';\nconst SOCKET_URL = API_BASE_URL;\nconst API_URL = `${API_BASE_URL}/api/chats`;\nconst USER_API_URL = `${API_BASE_URL}/api/users`;\nconst playNotificationSound = () => {\n  // ðŸ’¡ Ensure you have a /public/notification.mp3 file\n  const audio = new Audio('/notification.mp3');\n  audio.play().catch(e => console.log('Autoplay blocked:', e));\n};\nconst formatLastSeen = timestamp => {\n  if (!timestamp) return 'Last seen recently';\n  const date = new Date(timestamp);\n  return `Last seen ${date.toLocaleTimeString([], {\n    hour: '2-digit',\n    minute: '2-digit'\n  })} on ${date.toLocaleDateString()}`;\n};\nconst Chat = () => {\n  _s();\n  const navigate = useNavigate();\n\n  // ðŸŸ¢ Stable User/Admin check\n  const user = JSON.parse(localStorage.getItem('user')) || null;\n  const token = localStorage.getItem('token');\n  const currentUserId = user ? user.id || user._id : null;\n  const isAdmin = user && user.role === 'admin'; // Correctly reads role\n\n  const [messageInput, setMessageInput] = useState('');\n  const [messageList, setMessageList] = useState([]);\n  const [typingStatus, setTypingStatus] = useState('');\n  const [editingMessageId, setEditingMessageId] = useState(null);\n  const [editedContent, setEditedContent] = useState('');\n  const [staffDirectory, setStaffDirectory] = useState([]);\n  const [activeChat, setActiveChat] = useState(null);\n  const [unreadCounts, setUnreadCounts] = useState({});\n  const [onlineStatus, setOnlineStatus] = useState({});\n  const [lastSeenData, setLastSeenData] = useState({});\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [currentView, setCurrentView] = useState('chat');\n  const messagesEndRef = useRef(null);\n  const typingTimeoutRef = useRef(null);\n  const activeChatIdRef = useRef(null);\n  const hasFetchedStaffRef = useRef(false);\n  const activeChatId = useMemo(() => {\n    if (!currentUserId) return 'loading';\n    if (!activeChat) {\n      return 'global-staff-group-id';\n    }\n    const ids = [currentUserId, activeChat._id].filter(id => id).sort();\n    return ids.join('_');\n  }, [currentUserId, activeChat]);\n  useEffect(() => {\n    activeChatIdRef.current = activeChatId;\n  }, [activeChatId]);\n  const socket = useMemo(() => {\n    if (token) {\n      return io(SOCKET_URL, {\n        auth: {\n          token: token\n        },\n        autoConnect: true\n      });\n    }\n    return {\n      connected: false,\n      emit: () => {},\n      on: () => () => {},\n      off: () => () => {},\n      disconnect: () => {}\n    };\n  }, [token]);\n  const getAxiosConfig = useCallback((isMultipart = false) => ({\n    headers: {\n      'x-auth-token': token,\n      'Content-Type': isMultipart ? undefined : 'application/json'\n    }\n  }), [token]);\n  const fetchMessages = useCallback(async () => {\n    if (!token || activeChatId === 'loading' || !socket.connected) return;\n    try {\n      const res = await axios.get(`${API_URL}/${activeChatId}`, getAxiosConfig());\n      setMessageList(res.data);\n    } catch (err) {\n      console.error('Failed to fetch messages:', err);\n    }\n  }, [activeChatId, token, socket.connected, getAxiosConfig]);\n  const fetchStaffDirectory = useCallback(async () => {\n    if (!currentUserId || !token) return;\n    try {\n      const res = await axios.get(`${USER_API_URL}`, getAxiosConfig());\n      const filteredUsers = res.data.filter(u => u._id !== currentUserId);\n      setStaffDirectory(filteredUsers);\n      const initialLastSeen = {};\n      filteredUsers.forEach(u => {\n        if (u.lastActive) {\n          initialLastSeen[u._id] = u.lastActive;\n        }\n      });\n      setLastSeenData(prev => ({\n        ...prev,\n        ...initialLastSeen\n      }));\n    } catch (err) {\n      console.error('Failed to fetch staff directory:', err);\n    }\n  }, [currentUserId, token, getAxiosConfig]);\n  const handleChatSelect = useCallback(chatMember => {\n    setCurrentView('chat');\n    setMessageList([]);\n    setEditingMessageId(null);\n    setTypingStatus('');\n    setMessageInput('');\n    setActiveChat(chatMember);\n    const targetChatId = chatMember ? [currentUserId, chatMember._id].sort().join('_') : 'global-staff-group-id';\n    setUnreadCounts(prev => ({\n      ...prev,\n      [targetChatId]: 0\n    }));\n  }, [currentUserId]);\n  const handleManageUsers = () => {\n    setCurrentView('manage-users');\n    setActiveChat(null);\n    setMessageList([]);\n  };\n\n  // --- EFFECT FOR INITIAL DATA FETCHING ---\n  useEffect(() => {\n    if (!user || !token) {\n      navigate('/login');\n      return;\n    }\n    if (user && !hasFetchedStaffRef.current) {\n      fetchStaffDirectory();\n      hasFetchedStaffRef.current = true;\n    }\n  }, [user, token, navigate, fetchStaffDirectory]);\n\n  // ... (useEffect for Socket Joining and Message Fetching) ...\n  useEffect(() => {\n    if (!currentUserId || activeChatId === 'loading' || !socket.connected) return;\n    socket.emit('join_chat', activeChatId);\n    fetchMessages();\n  }, [currentUserId, activeChatId, socket, fetchMessages, socket.connected]);\n\n  // --- EFFECT FOR SOCKET LISTENERS (Updated Notification Logic) ---\n  useEffect(() => {\n    if (!user || !token) {\n      return;\n    }\n    socket.on('user_status_update', data => {\n      setOnlineStatus(prev => ({\n        ...prev,\n        [data.userId]: data.isOnline\n      }));\n      if (!data.isOnline && data.lastActive) {\n        setLastSeenData(prev => ({\n          ...prev,\n          [data.userId]: data.lastActive\n        }));\n      }\n    });\n    socket.on('receive_message', data => {\n      var _data$sender;\n      const messageChatId = data.chatId;\n      const isSentByMe = ((_data$sender = data.sender) === null || _data$sender === void 0 ? void 0 : _data$sender._id) === currentUserId;\n      if (messageChatId === activeChatIdRef.current) {\n        var _data$sender2;\n        // Message for ACTIVE chat: Add message, but DO NOT play sound.\n        const newMessage = {\n          ...data,\n          sender: (_data$sender2 = data.sender) !== null && _data$sender2 !== void 0 && _data$sender2._id ? data.sender : {\n            name: data.senderName,\n            _id: data.senderId\n          }\n        };\n        setMessageList(list => [...list, newMessage]);\n        setTypingStatus('');\n\n        // ðŸ’¥ FIX: Removed 'playNotificationSound()' from the active chat block.\n        // It only plays sound for non-active chats now, avoiding disturbance in the current chat.\n\n        setUnreadCounts(prev => ({\n          ...prev,\n          [messageChatId]: 0\n        }));\n      } else if (!isSentByMe) {\n        // Message for NON-ACTIVE chat: Play sound and increment unread count.\n        playNotificationSound();\n        setUnreadCounts(prev => ({\n          ...prev,\n          [messageChatId]: (prev[messageChatId] || 0) + 1\n        }));\n      }\n    });\n    socket.on('typing_status', data => {\n      if (currentUserId && data.isTyping && data.senderId !== currentUserId && data.chatId === activeChatIdRef.current) {\n        setTypingStatus(`${data.senderName} is typing...`);\n      } else if (data.chatId === activeChatIdRef.current) {\n        setTypingStatus('');\n      }\n    });\n    socket.on('message_edited', data => {\n      if (data.chatId === activeChatIdRef.current) {\n        setMessageList(list => list.map(msg => msg._id === data.messageId ? {\n          ...msg,\n          content: data.newContent,\n          edited: true\n        } : msg));\n      }\n    });\n    socket.on('message_deleted', data => {\n      if (data.chatId === activeChatIdRef.current && data.deleteForEveryone) {\n        setMessageList(list => list.filter(msg => msg._id !== data.messageId));\n      }\n    });\n    return () => {\n      socket.off('receive_message');\n      socket.off('typing_status');\n      socket.off('message_edited');\n      socket.off('message_deleted');\n      socket.off('user_status_update');\n    };\n  }, [user, token, socket, currentUserId, activeChat]);\n\n  // --- Modal Handlers ---\n  const openModal = () => setIsModalOpen(true);\n  const closeModal = () => setIsModalOpen(false);\n  const handleUserRegistered = () => {\n    fetchStaffDirectory();\n    closeModal();\n    setCurrentView('manage-users');\n  };\n\n  // --- Input and Message Handlers ---\n\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messageList]);\n  const handleTyping = e => {\n    setMessageInput(e.target.value);\n    if (!currentUserId) return;\n    socket.emit('typing', {\n      chatId: activeChatId,\n      senderId: currentUserId,\n      senderName: user.name,\n      isTyping: true\n    });\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    typingTimeoutRef.current = setTimeout(() => {\n      socket.emit('typing', {\n        chatId: activeChatId,\n        senderId: currentUserId,\n        senderName: user.name,\n        isTyping: false\n      });\n    }, 1000);\n  };\n  const sendTextMessage = async () => {\n    if (!messageInput.trim()) return;\n    const sanitizedContent = messageInput.trim().replace(/\\n/g, '\\\\n');\n    setMessageInput('');\n    try {\n      const res = await axios.post(`${API_URL}/text`, {\n        chatId: activeChatId,\n        content: sanitizedContent\n      }, getAxiosConfig());\n      const broadcastData = {\n        ...res.data,\n        chatId: activeChatId\n      };\n      setMessageList(list => [...list, broadcastData]);\n      socket.emit('send_message', broadcastData);\n    } catch (err) {\n      var _err$response;\n      console.error('Failed to send text message:', ((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data) || err.message);\n      setMessageInput(sanitizedContent.replace(/\\\\n/g, '\\n'));\n    }\n  };\n  const sendFileMessage = async (file, type) => {\n    if (!currentUserId || !file) return;\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('chatId', activeChatId);\n    formData.append('type', type);\n    try {\n      const res = await axios.post(`${API_URL}/upload`, formData, getAxiosConfig(true));\n      const broadcastData = {\n        ...res.data,\n        chatId: activeChatId\n      };\n      setMessageList(list => [...list, broadcastData]);\n      socket.emit('send_message', broadcastData);\n    } catch (err) {\n      var _err$response2;\n      console.error('Failed to send file message:', ((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.data) || err.message);\n      alert('File upload failed.');\n    }\n  };\n\n  // ðŸŸ¢ FIX 1: Robust file type checking\n  const handleFileChange = e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    let type;\n    const mimeType = file.type;\n    if (mimeType.startsWith('image/')) {\n      type = 'image';\n    } else if (mimeType === 'application/pdf') {\n      type = 'pdf';\n      // ðŸŸ¢ CRITICAL FIX: Add ODT MIME type check\n    } else if (mimeType === 'application/vnd.oasis.opendocument.text' || mimeType === 'application/msword' || mimeType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || mimeType === 'application/vnd.ms-excel' || mimeType === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {\n      type = 'document';\n    } else {\n      // Treat everything else as a general document\n      type = 'document';\n    }\n\n    // Basic file size check (e.g., limit to 10MB)\n    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\n    if (file.size > MAX_FILE_SIZE) {\n      alert(\"File is too large. Max size is 10MB.\");\n      e.target.value = null;\n      return;\n    }\n    sendFileMessage(file, type);\n    e.target.value = null;\n  };\n  const handleEditClick = message => {\n    setEditingMessageId(message._id);\n    setEditedContent(message.content.replace(/\\\\n/g, '\\n'));\n  };\n  const handleSaveEdit = async messageId => {\n    if (!editedContent.trim()) return;\n    const sanitizedEditedContent = editedContent.trim().replace(/\\n/g, '\\\\n');\n    try {\n      await axios.put(`${API_URL}/${messageId}`, {\n        content: sanitizedEditedContent\n      }, getAxiosConfig());\n      setMessageList(list => list.map(msg => msg._id === messageId ? {\n        ...msg,\n        content: sanitizedEditedContent,\n        edited: true\n      } : msg));\n      socket.emit('edit_message', {\n        messageId,\n        chatId: activeChatId,\n        newContent: sanitizedEditedContent\n      });\n      setEditingMessageId(null);\n      setEditedContent('');\n    } catch (err) {\n      console.error('Failed to save edit:', err);\n    }\n  };\n  const handleDeleteClick = async (messageId, deleteForEveryone) => {\n    if (!window.confirm(`Are you sure you want to delete this message ${deleteForEveryone ? 'for everyone' : 'just for you'}?`)) {\n      return;\n    }\n    try {\n      await axios.delete(`${API_URL}/${messageId}`, {\n        ...getAxiosConfig(),\n        data: {\n          deleteForEveryone,\n          chatId: activeChatId\n        }\n      });\n      if (!deleteForEveryone) {\n        setMessageList(list => list.filter(msg => msg._id !== messageId));\n      }\n      // If deleteForEveryone is true, the socket will handle updating the list\n    } catch (err) {\n      console.error('Failed to delete message:', err);\n    }\n  };\n\n  // ðŸŸ¢ FIX 2: Restrict image size display and differentiate documents\n  const renderMessageContent = msg => {\n    const content = msg.content || msg.fileUrl;\n    const displayContent = msg.type === 'text' && content ? content.replace(/\\\\n/g, '<br/>') : content;\n    const fileSrc = content.startsWith('/uploads/') ? `${SOCKET_URL}${content}` : content;\n    if (msg.type === 'image') {\n      // ðŸ’¡ Uses CSS class .chat-image for max-width/max-height\n      return /*#__PURE__*/_jsxDEV(\"img\", {\n        src: fileSrc,\n        alt: \"shared image\",\n        className: \"chat-image\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 20\n      }, this);\n    }\n    const fileName = content.split('/').pop();\n    if (msg.type === 'pdf') {\n      return /*#__PURE__*/_jsxDEV(\"a\", {\n        href: fileSrc,\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        className: \"chat-document-link pdf-link\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"file-icon\",\n          children: \"\\uD83D\\uDCC4 PDF:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 17\n        }, this), \" \", fileName]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 21\n      }, this);\n    }\n    if (msg.type === 'document') {\n      return /*#__PURE__*/_jsxDEV(\"a\", {\n        href: fileSrc,\n        target: \"_blank\",\n        rel: \"noopener noreferrer\",\n        className: \"chat-document-link\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"file-icon\",\n          children: \"\\uD83D\\uDCCE File:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 17\n        }, this), \" \", fileName]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 20\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      dangerouslySetInnerHTML: {\n        __html: displayContent\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 16\n    }, this);\n  };\n  if (!user || !currentUserId) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Redirecting to login...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 43\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-app-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-sidebar\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"\\uD83D\\uDC65 Staff Directory\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"current-user-tag\",\n          children: [\"Chatting as: **\", user.name, \"**\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 21\n        }, this), isAdmin && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `chat-item admin-view-toggle ${currentView === 'manage-users' ? 'active' : ''}`,\n          onClick: handleManageUsers,\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"chat-icon\",\n            children: \"\\uD83D\\uDEE0\\uFE0F\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-info\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"chat-name\",\n              children: \"**Manage Staff**\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 425,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 424,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-list\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: `chat-item ${!activeChat && currentView === 'chat' ? 'active' : ''}`,\n            onClick: () => handleChatSelect(null),\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"chat-icon\",\n              children: \"\\uD83C\\uDF10\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-info\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"chat-name\",\n                children: \"**Global Staff Group**\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 438,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 437,\n              columnNumber: 29\n            }, this), unreadCounts['global-staff-group-id'] > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"unread-badge\",\n              children: unreadCounts['global-staff-group-id']\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 441,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 432,\n            columnNumber: 25\n          }, this), staffDirectory.map(member => {\n            const oneOnOneChatId = [currentUserId, member._id].sort().join('_');\n            const count = unreadCounts[oneOnOneChatId] || 0;\n            const isOnline = onlineStatus[member._id];\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `chat-item ${(activeChat === null || activeChat === void 0 ? void 0 : activeChat._id) === member._id && currentView === 'chat' ? 'active' : ''}`,\n              onClick: () => handleChatSelect(member),\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: `chat-icon user-status-icon ${isOnline ? 'online' : 'offline'}`,\n                children: \"\\uD83D\\uDC64\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 456,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-info\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"chat-name\",\n                  children: [\"**\", member.name, \"**\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 458,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                  className: \"chat-status\",\n                  children: isOnline ? 'Online' : 'Offline'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 459,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 37\n              }, this), count > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"unread-badge\",\n                children: count\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 41\n              }, this)]\n            }, member._id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 451,\n              columnNumber: 33\n            }, this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 21\n        }, this), isAdmin && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"admin-add-user-button\",\n          onClick: openModal,\n          children: \"\\u2795 Add New Staff User\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 470,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"logout-button\",\n          onClick: () => {\n            localStorage.clear();\n            socket.disconnect();\n            navigate('/login');\n          },\n          children: \"Logout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 477,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 412,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-main-area\",\n        children: currentView === 'chat' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: [\"Current Chat: **\", activeChat ? activeChat.name : 'Global Staff Group', \"**\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 493,\n              columnNumber: 33\n            }, this), activeChat && /*#__PURE__*/_jsxDEV(\"small\", {\n              className: \"chat-header-status\",\n              children: onlineStatus[activeChat._id] ? /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"status-online\",\n                children: \"Online\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 497,\n                columnNumber: 45\n              }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"status-offline\",\n                children: formatLastSeen(lastSeenData[activeChat._id] || activeChat.lastActive)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 499,\n                columnNumber: 45\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 495,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 492,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-area\",\n            children: [messageList.map((msg, index) => {\n              var _msg$sender, _msg$sender2, _msg$sender3;\n              const senderName = ((_msg$sender = msg.sender) === null || _msg$sender === void 0 ? void 0 : _msg$sender.name) || 'System';\n              const isSentByMe = (((_msg$sender2 = msg.sender) === null || _msg$sender2 === void 0 ? void 0 : _msg$sender2._id) || ((_msg$sender3 = msg.sender) === null || _msg$sender3 === void 0 ? void 0 : _msg$sender3.id)) === currentUserId;\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `message-bubble-wrapper ${isSentByMe ? 'sent' : 'received'}`,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"message-bubble\",\n                  children: [!isSentByMe && /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"sender-name-label\",\n                    children: senderName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 515,\n                    columnNumber: 65\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"message-content\",\n                    children: editingMessageId === msg._id && isSentByMe ? /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"edit-mode\",\n                      children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n                        value: editedContent,\n                        onChange: e => setEditedContent(e.target.value),\n                        rows: Math.min(10, editedContent.split('\\n').length + 1)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 521,\n                        columnNumber: 61\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        onClick: () => handleSaveEdit(msg._id),\n                        disabled: !editedContent.trim(),\n                        children: \"Save\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 526,\n                        columnNumber: 61\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        onClick: () => setEditingMessageId(null),\n                        children: \"Cancel\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 527,\n                        columnNumber: 61\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 520,\n                      columnNumber: 57\n                    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"message-text\",\n                        children: [renderMessageContent(msg), msg.edited && /*#__PURE__*/_jsxDEV(\"small\", {\n                          className: \"edited-tag\",\n                          children: \"(edited)\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 533,\n                          columnNumber: 80\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 531,\n                        columnNumber: 61\n                      }, this), isSentByMe && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"message-controls\",\n                        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                          onClick: () => handleEditClick(msg),\n                          title: \"Edit\",\n                          children: \"\\u270F\\uFE0F\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 537,\n                          columnNumber: 69\n                        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                          onClick: () => handleDeleteClick(msg._id, false),\n                          title: \"Delete Just For Me\",\n                          children: \"\\uD83D\\uDDD1\\uFE0F\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 538,\n                          columnNumber: 69\n                        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                          onClick: () => handleDeleteClick(msg._id, true),\n                          title: \"Delete For Everyone\",\n                          children: \"\\u274C\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 539,\n                          columnNumber: 69\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 536,\n                        columnNumber: 65\n                      }, this)]\n                    }, void 0, true)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 517,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                    className: \"message-timestamp\",\n                    children: new Date(msg.timestamp).toLocaleTimeString([], {\n                      hour: '2-digit',\n                      minute: '2-digit'\n                    })\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 545,\n                    columnNumber: 49\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 514,\n                  columnNumber: 45\n                }, this)\n              }, msg._id || index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 513,\n                columnNumber: 41\n              }, this);\n            }), /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: messagesEndRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 552,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 507,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"input-footer\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"typing-status\",\n              children: typingStatus\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 556,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"input-area\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"file-upload-btn\",\n                children: [\"\\uD83D\\uDCC1\", /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\",\n                  onChange: handleFileChange,\n                  style: {\n                    display: 'none'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 560,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 558,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                placeholder: \"Type a message...\",\n                value: messageInput,\n                onChange: handleTyping,\n                onKeyDown: e => {\n                  if (e.key === 'Enter') sendTextMessage();\n                },\n                className: \"message-input\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 563,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: sendTextMessage,\n                disabled: !messageInput.trim(),\n                className: \"send-btn\",\n                children: \"Send\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 571,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 557,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 555,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true) :\n        /*#__PURE__*/\n        // --- ADMIN MANAGEMENT VIEW ---\n        _jsxDEV(\"div\", {\n          className: \"admin-management-view\",\n          children: /*#__PURE__*/_jsxDEV(UserManagement, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 578,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 577,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 13\n    }, this), isModalOpen && isAdmin && /*#__PURE__*/_jsxDEV(AdminRegisterModal, {\n      onClose: closeModal,\n      onUserRegistered: handleUserRegistered\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 585,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true);\n};\n_s(Chat, \"Vl2B8ivCzwete+pjjdOpfrm1Ewo=\", false, function () {\n  return [useNavigate];\n});\n_c = Chat;\nexport default Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","useMemo","io","axios","useNavigate","AdminRegisterModal","UserManagement","jsxDEV","_jsxDEV","Fragment","_Fragment","API_BASE_URL","process","env","REACT_APP_API_BASE_URL","SOCKET_URL","API_URL","USER_API_URL","playNotificationSound","audio","Audio","play","catch","e","console","log","formatLastSeen","timestamp","date","Date","toLocaleTimeString","hour","minute","toLocaleDateString","Chat","_s","navigate","user","JSON","parse","localStorage","getItem","token","currentUserId","id","_id","isAdmin","role","messageInput","setMessageInput","messageList","setMessageList","typingStatus","setTypingStatus","editingMessageId","setEditingMessageId","editedContent","setEditedContent","staffDirectory","setStaffDirectory","activeChat","setActiveChat","unreadCounts","setUnreadCounts","onlineStatus","setOnlineStatus","lastSeenData","setLastSeenData","isModalOpen","setIsModalOpen","currentView","setCurrentView","messagesEndRef","typingTimeoutRef","activeChatIdRef","hasFetchedStaffRef","activeChatId","ids","filter","sort","join","current","socket","auth","autoConnect","connected","emit","on","off","disconnect","getAxiosConfig","isMultipart","headers","undefined","fetchMessages","res","get","data","err","error","fetchStaffDirectory","filteredUsers","u","initialLastSeen","forEach","lastActive","prev","handleChatSelect","chatMember","targetChatId","handleManageUsers","userId","isOnline","_data$sender","messageChatId","chatId","isSentByMe","sender","_data$sender2","newMessage","name","senderName","senderId","list","isTyping","map","msg","messageId","content","newContent","edited","deleteForEveryone","openModal","closeModal","handleUserRegistered","_messagesEndRef$curre","scrollIntoView","behavior","handleTyping","target","value","clearTimeout","setTimeout","sendTextMessage","trim","sanitizedContent","replace","post","broadcastData","_err$response","response","message","sendFileMessage","file","type","formData","FormData","append","_err$response2","alert","handleFileChange","files","mimeType","startsWith","MAX_FILE_SIZE","size","handleEditClick","handleSaveEdit","sanitizedEditedContent","put","handleDeleteClick","window","confirm","delete","renderMessageContent","fileUrl","displayContent","fileSrc","src","alt","className","fileName","_jsxFileName","lineNumber","columnNumber","split","pop","href","rel","children","dangerouslySetInnerHTML","__html","onClick","member","oneOnOneChatId","count","clear","index","_msg$sender","_msg$sender2","_msg$sender3","onChange","rows","Math","min","length","disabled","title","ref","style","display","placeholder","onKeyDown","key","onClose","onUserRegistered","_c","$RefreshReg$"],"sources":["/home/ubuntu/Desktop/app/Chat_application/ChatApplication/frontend/src/pages/Chat.jsx"],"sourcesContent":["// office-chat-frontend/src/components/Chat.js\n\nimport React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';\nimport io from 'socket.io-client';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport './Chat.css'; \nimport AdminRegisterModal from './AdminRegisterModal'; \nimport UserManagement from './UserManagement'; \n\nconst API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:5000'; \nconst SOCKET_URL = API_BASE_URL; \nconst API_URL = `${API_BASE_URL}/api/chats`;\nconst USER_API_URL = `${API_BASE_URL}/api/users`;\n\nconst playNotificationSound = () => {\n    // ðŸ’¡ Ensure you have a /public/notification.mp3 file\n    const audio = new Audio('/notification.mp3'); \n    audio.play().catch(e => console.log('Autoplay blocked:', e)); \n};\n\nconst formatLastSeen = (timestamp) => {\n    if (!timestamp) return 'Last seen recently';\n    const date = new Date(timestamp);\n    return `Last seen ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} on ${date.toLocaleDateString()}`;\n};\n\nconst Chat = () => {\n    const navigate = useNavigate(); \n    \n    // ðŸŸ¢ Stable User/Admin check\n    const user = JSON.parse(localStorage.getItem('user')) || null;\n    const token = localStorage.getItem('token'); \n    const currentUserId = user ? (user.id || user._id) : null; \n    const isAdmin = user && user.role === 'admin'; // Correctly reads role\n\n    const [messageInput, setMessageInput] = useState('');\n    const [messageList, setMessageList] = useState([]);\n    const [typingStatus, setTypingStatus] = useState('');\n    const [editingMessageId, setEditingMessageId] = useState(null);\n    const [editedContent, setEditedContent] = useState('');\n    \n    const [staffDirectory, setStaffDirectory] = useState([]);\n    const [activeChat, setActiveChat] = useState(null); \n    \n    const [unreadCounts, setUnreadCounts] = useState({}); \n    const [onlineStatus, setOnlineStatus] = useState({}); \n    const [lastSeenData, setLastSeenData] = useState({}); \n    \n    const [isModalOpen, setIsModalOpen] = useState(false); \n    const [currentView, setCurrentView] = useState('chat'); \n\n    const messagesEndRef = useRef(null);\n    const typingTimeoutRef = useRef(null); \n    const activeChatIdRef = useRef(null); \n    const hasFetchedStaffRef = useRef(false);\n\n    const activeChatId = useMemo(() => {\n        if (!currentUserId) return 'loading'; \n        if (!activeChat) { return 'global-staff-group-id'; } \n        const ids = [currentUserId, activeChat._id].filter(id => id).sort();\n        return ids.join('_');\n    }, [currentUserId, activeChat]);\n    \n    useEffect(() => {\n        activeChatIdRef.current = activeChatId;\n    }, [activeChatId]);\n\n    const socket = useMemo(() => {\n        if (token) {\n            return io(SOCKET_URL, { auth: { token: token }, autoConnect: true });\n        }\n        return { connected: false, emit: () => {}, on: () => () => {}, off: () => () => {}, disconnect: () => {} };\n    }, [token]);\n\n    const getAxiosConfig = useCallback((isMultipart = false) => ({\n        headers: {\n            'x-auth-token': token,\n            'Content-Type': isMultipart ? undefined : 'application/json',\n        },\n    }), [token]);\n\n    const fetchMessages = useCallback(async () => {\n        if (!token || activeChatId === 'loading' || !socket.connected) return; \n        try {\n            const res = await axios.get(`${API_URL}/${activeChatId}`, getAxiosConfig());\n            setMessageList(res.data);\n        } catch (err) {\n            console.error('Failed to fetch messages:', err);\n        }\n    }, [activeChatId, token, socket.connected, getAxiosConfig]);\n\n    const fetchStaffDirectory = useCallback(async () => {\n        if (!currentUserId || !token) return;\n        try {\n            const res = await axios.get(`${USER_API_URL}`, getAxiosConfig()); \n            const filteredUsers = res.data.filter(u => u._id !== currentUserId);\n            \n            setStaffDirectory(filteredUsers); \n            \n            const initialLastSeen = {};\n            filteredUsers.forEach(u => {\n                if (u.lastActive) {\n                    initialLastSeen[u._id] = u.lastActive;\n                }\n            });\n            setLastSeenData(prev => ({ ...prev, ...initialLastSeen }));\n\n        } catch (err) {\n            console.error('Failed to fetch staff directory:', err);\n        }\n    }, [currentUserId, token, getAxiosConfig]); \n\n    const handleChatSelect = useCallback((chatMember) => {\n        setCurrentView('chat'); \n        setMessageList([]); \n        setEditingMessageId(null); \n        setTypingStatus('');\n        setMessageInput('');\n        setActiveChat(chatMember);\n        \n        const targetChatId = chatMember ? [currentUserId, chatMember._id].sort().join('_') : 'global-staff-group-id';\n        setUnreadCounts(prev => ({ ...prev, [targetChatId]: 0 })); \n        \n    }, [currentUserId]); \n\n    const handleManageUsers = () => {\n        setCurrentView('manage-users');\n        setActiveChat(null); \n        setMessageList([]); \n    };\n\n    // --- EFFECT FOR INITIAL DATA FETCHING ---\n    useEffect(() => {\n        if (!user || !token) { \n            navigate('/login'); \n            return; \n        }\n        if (user && !hasFetchedStaffRef.current) {\n            fetchStaffDirectory();\n            hasFetchedStaffRef.current = true;\n        }\n    }, [user, token, navigate, fetchStaffDirectory]); \n\n    // ... (useEffect for Socket Joining and Message Fetching) ...\n    useEffect(() => {\n        if (!currentUserId || activeChatId === 'loading' || !socket.connected) return;\n        socket.emit('join_chat', activeChatId); \n        fetchMessages(); \n    }, [currentUserId, activeChatId, socket, fetchMessages, socket.connected]); \n\n    // --- EFFECT FOR SOCKET LISTENERS (Updated Notification Logic) ---\n    useEffect(() => {\n        if (!user || !token) { return; } \n\n        socket.on('user_status_update', (data) => {\n            setOnlineStatus(prev => ({ ...prev, [data.userId]: data.isOnline }));\n            if (!data.isOnline && data.lastActive) {\n                setLastSeenData(prev => ({ ...prev, [data.userId]: data.lastActive }));\n            }\n        });\n\n        socket.on('receive_message', (data) => {\n            const messageChatId = data.chatId;\n            const isSentByMe = data.sender?._id === currentUserId;\n            \n            if (messageChatId === activeChatIdRef.current) { \n                // Message for ACTIVE chat: Add message, but DO NOT play sound.\n                const newMessage = { \n                    ...data, \n                    sender: data.sender?._id ? data.sender : { name: data.senderName, _id: data.senderId } \n                };\n                setMessageList((list) => [...list, newMessage]);\n                setTypingStatus(''); \n                \n                // ðŸ’¥ FIX: Removed 'playNotificationSound()' from the active chat block.\n                // It only plays sound for non-active chats now, avoiding disturbance in the current chat.\n                \n                setUnreadCounts(prev => ({ ...prev, [messageChatId]: 0 })); \n            } else if (!isSentByMe) {\n                // Message for NON-ACTIVE chat: Play sound and increment unread count.\n                playNotificationSound();\n                setUnreadCounts(prev => ({ \n                    ...prev, \n                    [messageChatId]: (prev[messageChatId] || 0) + 1 \n                }));\n            }\n        });\n\n        socket.on('typing_status', (data) => {\n            if (currentUserId && data.isTyping && data.senderId !== currentUserId && data.chatId === activeChatIdRef.current) {\n                setTypingStatus(`${data.senderName} is typing...`);\n            } else if (data.chatId === activeChatIdRef.current) {\n                setTypingStatus('');\n            }\n        });\n        \n        socket.on('message_edited', (data) => {\n            if (data.chatId === activeChatIdRef.current) {\n                setMessageList(list => list.map(msg => \n                    msg._id === data.messageId ? { ...msg, content: data.newContent, edited: true } : msg\n                ));\n            }\n        });\n\n        socket.on('message_deleted', (data) => {\n            if (data.chatId === activeChatIdRef.current && data.deleteForEveryone) {\n                setMessageList(list => list.filter(msg => msg._id !== data.messageId));\n            }\n        });\n\n        return () => {\n            socket.off('receive_message');\n            socket.off('typing_status');\n            socket.off('message_edited');\n            socket.off('message_deleted');\n            socket.off('user_status_update'); \n        };\n    }, [user, token, socket, currentUserId, activeChat]); \n\n\n    // --- Modal Handlers ---\n    const openModal = () => setIsModalOpen(true);\n    const closeModal = () => setIsModalOpen(false);\n    \n    const handleUserRegistered = () => {\n        fetchStaffDirectory(); \n        closeModal();\n        setCurrentView('manage-users');\n    };\n\n    // --- Input and Message Handlers ---\n    \n    useEffect(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n    }, [messageList]);\n\n    const handleTyping = (e) => {\n        setMessageInput(e.target.value);\n        if (!currentUserId) return; \n        \n        socket.emit('typing', { chatId: activeChatId, senderId: currentUserId, senderName: user.name, isTyping: true });\n\n        if (typingTimeoutRef.current) { clearTimeout(typingTimeoutRef.current); }\n        \n        typingTimeoutRef.current = setTimeout(() => {\n            socket.emit('typing', { chatId: activeChatId, senderId: currentUserId, senderName: user.name, isTyping: false });\n        }, 1000); \n    };\n\n    const sendTextMessage = async () => {\n        if (!messageInput.trim()) return;\n        \n        const sanitizedContent = messageInput.trim().replace(/\\n/g, '\\\\n');\n        setMessageInput('');\n\n        try {\n            const res = await axios.post(`${API_URL}/text`, { chatId: activeChatId, content: sanitizedContent }, getAxiosConfig());\n            \n            const broadcastData = { ...res.data, chatId: activeChatId };\n\n            setMessageList(list => [...list, broadcastData]); \n            socket.emit('send_message', broadcastData);\n\n        } catch (err) {\n            console.error('Failed to send text message:', err.response?.data || err.message); \n            setMessageInput(sanitizedContent.replace(/\\\\n/g, '\\n')); \n        }\n    };\n    \n    const sendFileMessage = async (file, type) => {\n        if (!currentUserId || !file) return;\n\n        const formData = new FormData();\n        formData.append('file', file);\n        formData.append('chatId', activeChatId);\n        formData.append('type', type);\n\n        try {\n            const res = await axios.post(`${API_URL}/upload`, formData, getAxiosConfig(true)); \n            \n            const broadcastData = { ...res.data, chatId: activeChatId };\n\n            setMessageList(list => [...list, broadcastData]); \n            socket.emit('send_message', broadcastData);\n\n        } catch (err) {\n            console.error('Failed to send file message:', err.response?.data || err.message);\n            alert('File upload failed.');\n        } \n    };\n\n    // ðŸŸ¢ FIX 1: Robust file type checking\n    const handleFileChange = (e) => {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        let type;\n        const mimeType = file.type;\n\n        if (mimeType.startsWith('image/')) {\n            type = 'image';\n        } else if (mimeType === 'application/pdf') {\n            type = 'pdf';\n        // ðŸŸ¢ CRITICAL FIX: Add ODT MIME type check\n        } else if (mimeType === 'application/vnd.oasis.opendocument.text' || \n                   mimeType === 'application/msword' || \n                   mimeType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || \n                   mimeType === 'application/vnd.ms-excel' ||\n                   mimeType === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {\n             type = 'document';\n        } else {\n            // Treat everything else as a general document\n            type = 'document'; \n        }\n        \n        // Basic file size check (e.g., limit to 10MB)\n        const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\n        if (file.size > MAX_FILE_SIZE) {\n            alert(\"File is too large. Max size is 10MB.\");\n            e.target.value = null; \n            return;\n        }\n\n        sendFileMessage(file, type);\n        e.target.value = null; \n    };\n\n    const handleEditClick = (message) => { \n        setEditingMessageId(message._id); \n        setEditedContent(message.content.replace(/\\\\n/g, '\\n')); \n    };\n    \n    const handleSaveEdit = async (messageId) => { \n        if (!editedContent.trim()) return;\n        \n        const sanitizedEditedContent = editedContent.trim().replace(/\\n/g, '\\\\n');\n\n        try {\n            await axios.put(`${API_URL}/${messageId}`, { content: sanitizedEditedContent }, getAxiosConfig());\n            \n            setMessageList(list => list.map(msg => \n                msg._id === messageId ? { ...msg, content: sanitizedEditedContent, edited: true } : msg\n            ));\n            \n            socket.emit('edit_message', { messageId, chatId: activeChatId, newContent: sanitizedEditedContent });\n\n            setEditingMessageId(null);\n            setEditedContent('');\n        } catch (err) {\n            console.error('Failed to save edit:', err);\n        }\n    };\n\n    const handleDeleteClick = async (messageId, deleteForEveryone) => { \n        if (!window.confirm(`Are you sure you want to delete this message ${deleteForEveryone ? 'for everyone' : 'just for you'}?`)) {\n            return;\n        }\n        \n        try {\n            await axios.delete(`${API_URL}/${messageId}`, { \n                ...getAxiosConfig(),\n                data: { deleteForEveryone, chatId: activeChatId }\n            });\n            \n            if (!deleteForEveryone) {\n                setMessageList(list => list.filter(msg => msg._id !== messageId));\n            }\n            // If deleteForEveryone is true, the socket will handle updating the list\n        } catch (err) {\n            console.error('Failed to delete message:', err);\n        }\n    };\n    \n    // ðŸŸ¢ FIX 2: Restrict image size display and differentiate documents\n    const renderMessageContent = (msg) => {\n        const content = msg.content || msg.fileUrl; \n        \n        const displayContent = (msg.type === 'text' && content) \n            ? content.replace(/\\\\n/g, '<br/>') \n            : content;\n\n        const fileSrc = content.startsWith('/uploads/') ? `${SOCKET_URL}${content}` : content;\n\n        if (msg.type === 'image') { \n            // ðŸ’¡ Uses CSS class .chat-image for max-width/max-height\n            return <img src={fileSrc} alt=\"shared image\" className=\"chat-image\" />; \n        } \n        \n        const fileName = content.split('/').pop();\n\n        if (msg.type === 'pdf') {\n             return <a href={fileSrc} target=\"_blank\" rel=\"noopener noreferrer\" className=\"chat-document-link pdf-link\">\n                <span className=\"file-icon\">ðŸ“„ PDF:</span> {fileName}\n            </a>;\n        }\n        \n        if (msg.type === 'document') { \n            return <a href={fileSrc} target=\"_blank\" rel=\"noopener noreferrer\" className=\"chat-document-link\">\n                <span className=\"file-icon\">ðŸ“Ž File:</span> {fileName}\n            </a>; \n        }\n        \n        return <div dangerouslySetInnerHTML={{ __html: displayContent }} />;\n    };\n\n    if (!user || !currentUserId) { return <div>Redirecting to login...</div>; }\n\n    return (\n        <>\n            <div className=\"chat-app-container\">\n                <div className=\"chat-sidebar\">\n                    <h3>ðŸ‘¥ Staff Directory</h3>\n                    <p className=\"current-user-tag\">Chatting as: **{user.name}**</p>\n                    <hr />\n\n                    {/* ADMIN MANAGEMENT OPTION */}\n                    {isAdmin && (\n                        <div \n                            className={`chat-item admin-view-toggle ${currentView === 'manage-users' ? 'active' : ''}`}\n                            onClick={handleManageUsers}\n                        >\n                            <span className=\"chat-icon\">ðŸ› ï¸</span>\n                            <div className=\"chat-info\">\n                                <p className=\"chat-name\">**Manage Staff**</p>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className=\"chat-list\">\n                        {/* Global Chat Option */}\n                        <div \n                            className={`chat-item ${!activeChat && currentView === 'chat' ? 'active' : ''}`}\n                            onClick={() => handleChatSelect(null)}\n                        >\n                            <span className=\"chat-icon\">ðŸŒ</span>\n                            <div className=\"chat-info\">\n                                <p className=\"chat-name\">**Global Staff Group**</p>\n                            </div>\n                            {unreadCounts['global-staff-group-id'] > 0 && (\n                                <span className=\"unread-badge\">{unreadCounts['global-staff-group-id']}</span>\n                            )}\n                        </div>\n\n                        {staffDirectory.map(member => {\n                            const oneOnOneChatId = [currentUserId, member._id].sort().join('_');\n                            const count = unreadCounts[oneOnOneChatId] || 0;\n                            const isOnline = onlineStatus[member._id];\n                            \n                            return (\n                                <div \n                                    key={member._id} \n                                    className={`chat-item ${activeChat?._id === member._id && currentView === 'chat' ? 'active' : ''}`}\n                                    onClick={() => handleChatSelect(member)}\n                                >\n                                    <span className={`chat-icon user-status-icon ${isOnline ? 'online' : 'offline'}`}>ðŸ‘¤</span>\n                                    <div className=\"chat-info\">\n                                        <p className=\"chat-name\">**{member.name}**</p>\n                                        <small className=\"chat-status\">{isOnline ? 'Online' : 'Offline'}</small>\n                                    </div>\n                                    {count > 0 && (\n                                        <span className=\"unread-badge\">{count}</span>\n                                    )}\n                                </div>\n                            );\n                        })}\n                    </div>\n\n                    {isAdmin && (\n                        <button \n                            className=\"admin-add-user-button\"\n                            onClick={openModal}> \n                            âž• Add New Staff User\n                        </button>\n                    )}\n                    \n                    <button \n                        className=\"logout-button\"\n                        onClick={() => { \n                            localStorage.clear(); \n                            socket.disconnect(); \n                            navigate('/login'); \n                        }}>\n                        Logout\n                    </button>\n                </div>\n                \n                <div className=\"chat-main-area\">\n                    {currentView === 'chat' ? (\n                        <>\n                            {/* --- CHAT VIEW --- */}\n                            <div className=\"chat-header\">\n                                <h4>Current Chat: **{activeChat ? activeChat.name : 'Global Staff Group'}**</h4>\n                                {activeChat && (\n                                    <small className=\"chat-header-status\">\n                                        {onlineStatus[activeChat._id] ? (\n                                            <span className=\"status-online\">Online</span>\n                                        ) : (\n                                            <span className=\"status-offline\">\n                                                {formatLastSeen(lastSeenData[activeChat._id] || activeChat.lastActive)}\n                                            </span>\n                                        )}\n                                    </small>\n                                )}\n                            </div>\n\n                            <div className=\"message-area\">\n                                {messageList.map((msg, index) => {\n                                    const senderName = msg.sender?.name || 'System';\n                                    const isSentByMe = (msg.sender?._id || msg.sender?.id) === currentUserId;\n\n                                    return (\n                                        <div key={msg._id || index} className={`message-bubble-wrapper ${isSentByMe ? 'sent' : 'received'}`}>\n                                            <div className=\"message-bubble\">\n                                                {!isSentByMe && <span className=\"sender-name-label\">{senderName}</span>}\n                                                \n                                                <div className=\"message-content\">\n                                                    \n                                                    {editingMessageId === msg._id && isSentByMe ? (\n                                                        <div className=\"edit-mode\">\n                                                            <textarea \n                                                                value={editedContent}\n                                                                onChange={(e) => setEditedContent(e.target.value)}\n                                                                rows={Math.min(10, editedContent.split('\\n').length + 1)}\n                                                            />\n                                                            <button onClick={() => handleSaveEdit(msg._id)} disabled={!editedContent.trim()}>Save</button>\n                                                            <button onClick={() => setEditingMessageId(null)}>Cancel</button>\n                                                        </div>\n                                                    ) : (\n                                                        <>\n                                                            <div className=\"message-text\">\n                                                                {renderMessageContent(msg)}\n                                                                {msg.edited && <small className=\"edited-tag\">(edited)</small>}\n                                                            </div>\n                                                            {isSentByMe && (\n                                                                <div className=\"message-controls\">\n                                                                    <button onClick={() => handleEditClick(msg)} title=\"Edit\">âœï¸</button>\n                                                                    <button onClick={() => handleDeleteClick(msg._id, false)} title=\"Delete Just For Me\">ðŸ—‘ï¸</button>\n                                                                    <button onClick={() => handleDeleteClick(msg._id, true)} title=\"Delete For Everyone\">âŒ</button>\n                                                                </div>\n                                                            )}\n                                                        </>\n                                                    )}\n                                                </div>\n                                                <small className=\"message-timestamp\">\n                                                    {new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                                </small>\n                                            </div>\n                                        </div>\n                                    );\n                                })}\n                                <div ref={messagesEndRef} /> \n                            </div>\n\n                            <div className=\"input-footer\">\n                                <div className=\"typing-status\">{typingStatus}</div>\n                                <div className=\"input-area\">\n                                    <label className=\"file-upload-btn\">\n                                        ðŸ“\n                                        <input type=\"file\" onChange={handleFileChange} style={{display: 'none'}} />\n                                    </label>\n                                    \n                                    <input \n                                        type=\"text\" \n                                        placeholder=\"Type a message...\"\n                                        value={messageInput}\n                                        onChange={handleTyping}\n                                        onKeyDown={(e) => { if (e.key === 'Enter') sendTextMessage(); }}\n                                        className=\"message-input\"\n                                    />\n                                    <button onClick={sendTextMessage} disabled={!messageInput.trim()} className=\"send-btn\">Send</button>\n                                </div>\n                            </div>\n                        </>\n                    ) : (\n                        // --- ADMIN MANAGEMENT VIEW ---\n                        <div className=\"admin-management-view\">\n                            <UserManagement />\n                        </div>\n                    )}\n                </div>\n            </div>\n            \n            {isModalOpen && isAdmin && (\n                <AdminRegisterModal \n                    onClose={closeModal} \n                    onUserRegistered={handleUserRegistered}\n                />\n            )}\n        </>\n    );\n};\n\nexport default Chat;"],"mappings":";;AAAA;;AAEA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,WAAW,EAAEC,MAAM,EAAEC,OAAO,QAAQ,OAAO;AAChF,OAAOC,EAAE,MAAM,kBAAkB;AACjC,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAO,YAAY;AACnB,OAAOC,kBAAkB,MAAM,sBAAsB;AACrD,OAAOC,cAAc,MAAM,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE9C,MAAMC,YAAY,GAAGC,OAAO,CAACC,GAAG,CAACC,sBAAsB,IAAI,uBAAuB;AAClF,MAAMC,UAAU,GAAGJ,YAAY;AAC/B,MAAMK,OAAO,GAAG,GAAGL,YAAY,YAAY;AAC3C,MAAMM,YAAY,GAAG,GAAGN,YAAY,YAAY;AAEhD,MAAMO,qBAAqB,GAAGA,CAAA,KAAM;EAChC;EACA,MAAMC,KAAK,GAAG,IAAIC,KAAK,CAAC,mBAAmB,CAAC;EAC5CD,KAAK,CAACE,IAAI,CAAC,CAAC,CAACC,KAAK,CAACC,CAAC,IAAIC,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEF,CAAC,CAAC,CAAC;AAChE,CAAC;AAED,MAAMG,cAAc,GAAIC,SAAS,IAAK;EAClC,IAAI,CAACA,SAAS,EAAE,OAAO,oBAAoB;EAC3C,MAAMC,IAAI,GAAG,IAAIC,IAAI,CAACF,SAAS,CAAC;EAChC,OAAO,aAAaC,IAAI,CAACE,kBAAkB,CAAC,EAAE,EAAE;IAAEC,IAAI,EAAE,SAAS;IAAEC,MAAM,EAAE;EAAU,CAAC,CAAC,OAAOJ,IAAI,CAACK,kBAAkB,CAAC,CAAC,EAAE;AAC7H,CAAC;AAED,MAAMC,IAAI,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACf,MAAMC,QAAQ,GAAGhC,WAAW,CAAC,CAAC;;EAE9B;EACA,MAAMiC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,IAAI,IAAI;EAC7D,MAAMC,KAAK,GAAGF,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,MAAME,aAAa,GAAGN,IAAI,GAAIA,IAAI,CAACO,EAAE,IAAIP,IAAI,CAACQ,GAAG,GAAI,IAAI;EACzD,MAAMC,OAAO,GAAGT,IAAI,IAAIA,IAAI,CAACU,IAAI,KAAK,OAAO,CAAC,CAAC;;EAE/C,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGpD,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACqD,WAAW,EAAEC,cAAc,CAAC,GAAGtD,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACuD,YAAY,EAAEC,eAAe,CAAC,GAAGxD,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACyD,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG1D,QAAQ,CAAC,IAAI,CAAC;EAC9D,MAAM,CAAC2D,aAAa,EAAEC,gBAAgB,CAAC,GAAG5D,QAAQ,CAAC,EAAE,CAAC;EAEtD,MAAM,CAAC6D,cAAc,EAAEC,iBAAiB,CAAC,GAAG9D,QAAQ,CAAC,EAAE,CAAC;EACxD,MAAM,CAAC+D,UAAU,EAAEC,aAAa,CAAC,GAAGhE,QAAQ,CAAC,IAAI,CAAC;EAElD,MAAM,CAACiE,YAAY,EAAEC,eAAe,CAAC,GAAGlE,QAAQ,CAAC,CAAC,CAAC,CAAC;EACpD,MAAM,CAACmE,YAAY,EAAEC,eAAe,CAAC,GAAGpE,QAAQ,CAAC,CAAC,CAAC,CAAC;EACpD,MAAM,CAACqE,YAAY,EAAEC,eAAe,CAAC,GAAGtE,QAAQ,CAAC,CAAC,CAAC,CAAC;EAEpD,MAAM,CAACuE,WAAW,EAAEC,cAAc,CAAC,GAAGxE,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACyE,WAAW,EAAEC,cAAc,CAAC,GAAG1E,QAAQ,CAAC,MAAM,CAAC;EAEtD,MAAM2E,cAAc,GAAGxE,MAAM,CAAC,IAAI,CAAC;EACnC,MAAMyE,gBAAgB,GAAGzE,MAAM,CAAC,IAAI,CAAC;EACrC,MAAM0E,eAAe,GAAG1E,MAAM,CAAC,IAAI,CAAC;EACpC,MAAM2E,kBAAkB,GAAG3E,MAAM,CAAC,KAAK,CAAC;EAExC,MAAM4E,YAAY,GAAG3E,OAAO,CAAC,MAAM;IAC/B,IAAI,CAAC0C,aAAa,EAAE,OAAO,SAAS;IACpC,IAAI,CAACiB,UAAU,EAAE;MAAE,OAAO,uBAAuB;IAAE;IACnD,MAAMiB,GAAG,GAAG,CAAClC,aAAa,EAAEiB,UAAU,CAACf,GAAG,CAAC,CAACiC,MAAM,CAAClC,EAAE,IAAIA,EAAE,CAAC,CAACmC,IAAI,CAAC,CAAC;IACnE,OAAOF,GAAG,CAACG,IAAI,CAAC,GAAG,CAAC;EACxB,CAAC,EAAE,CAACrC,aAAa,EAAEiB,UAAU,CAAC,CAAC;EAE/B9D,SAAS,CAAC,MAAM;IACZ4E,eAAe,CAACO,OAAO,GAAGL,YAAY;EAC1C,CAAC,EAAE,CAACA,YAAY,CAAC,CAAC;EAElB,MAAMM,MAAM,GAAGjF,OAAO,CAAC,MAAM;IACzB,IAAIyC,KAAK,EAAE;MACP,OAAOxC,EAAE,CAACa,UAAU,EAAE;QAAEoE,IAAI,EAAE;UAAEzC,KAAK,EAAEA;QAAM,CAAC;QAAE0C,WAAW,EAAE;MAAK,CAAC,CAAC;IACxE;IACA,OAAO;MAAEC,SAAS,EAAE,KAAK;MAAEC,IAAI,EAAEA,CAAA,KAAM,CAAC,CAAC;MAAEC,EAAE,EAAEA,CAAA,KAAM,MAAM,CAAC,CAAC;MAAEC,GAAG,EAAEA,CAAA,KAAM,MAAM,CAAC,CAAC;MAAEC,UAAU,EAAEA,CAAA,KAAM,CAAC;IAAE,CAAC;EAC9G,CAAC,EAAE,CAAC/C,KAAK,CAAC,CAAC;EAEX,MAAMgD,cAAc,GAAG3F,WAAW,CAAC,CAAC4F,WAAW,GAAG,KAAK,MAAM;IACzDC,OAAO,EAAE;MACL,cAAc,EAAElD,KAAK;MACrB,cAAc,EAAEiD,WAAW,GAAGE,SAAS,GAAG;IAC9C;EACJ,CAAC,CAAC,EAAE,CAACnD,KAAK,CAAC,CAAC;EAEZ,MAAMoD,aAAa,GAAG/F,WAAW,CAAC,YAAY;IAC1C,IAAI,CAAC2C,KAAK,IAAIkC,YAAY,KAAK,SAAS,IAAI,CAACM,MAAM,CAACG,SAAS,EAAE;IAC/D,IAAI;MACA,MAAMU,GAAG,GAAG,MAAM5F,KAAK,CAAC6F,GAAG,CAAC,GAAGhF,OAAO,IAAI4D,YAAY,EAAE,EAAEc,cAAc,CAAC,CAAC,CAAC;MAC3EvC,cAAc,CAAC4C,GAAG,CAACE,IAAI,CAAC;IAC5B,CAAC,CAAC,OAAOC,GAAG,EAAE;MACV1E,OAAO,CAAC2E,KAAK,CAAC,2BAA2B,EAAED,GAAG,CAAC;IACnD;EACJ,CAAC,EAAE,CAACtB,YAAY,EAAElC,KAAK,EAAEwC,MAAM,CAACG,SAAS,EAAEK,cAAc,CAAC,CAAC;EAE3D,MAAMU,mBAAmB,GAAGrG,WAAW,CAAC,YAAY;IAChD,IAAI,CAAC4C,aAAa,IAAI,CAACD,KAAK,EAAE;IAC9B,IAAI;MACA,MAAMqD,GAAG,GAAG,MAAM5F,KAAK,CAAC6F,GAAG,CAAC,GAAG/E,YAAY,EAAE,EAAEyE,cAAc,CAAC,CAAC,CAAC;MAChE,MAAMW,aAAa,GAAGN,GAAG,CAACE,IAAI,CAACnB,MAAM,CAACwB,CAAC,IAAIA,CAAC,CAACzD,GAAG,KAAKF,aAAa,CAAC;MAEnEgB,iBAAiB,CAAC0C,aAAa,CAAC;MAEhC,MAAME,eAAe,GAAG,CAAC,CAAC;MAC1BF,aAAa,CAACG,OAAO,CAACF,CAAC,IAAI;QACvB,IAAIA,CAAC,CAACG,UAAU,EAAE;UACdF,eAAe,CAACD,CAAC,CAACzD,GAAG,CAAC,GAAGyD,CAAC,CAACG,UAAU;QACzC;MACJ,CAAC,CAAC;MACFtC,eAAe,CAACuC,IAAI,KAAK;QAAE,GAAGA,IAAI;QAAE,GAAGH;MAAgB,CAAC,CAAC,CAAC;IAE9D,CAAC,CAAC,OAAOL,GAAG,EAAE;MACV1E,OAAO,CAAC2E,KAAK,CAAC,kCAAkC,EAAED,GAAG,CAAC;IAC1D;EACJ,CAAC,EAAE,CAACvD,aAAa,EAAED,KAAK,EAAEgD,cAAc,CAAC,CAAC;EAE1C,MAAMiB,gBAAgB,GAAG5G,WAAW,CAAE6G,UAAU,IAAK;IACjDrC,cAAc,CAAC,MAAM,CAAC;IACtBpB,cAAc,CAAC,EAAE,CAAC;IAClBI,mBAAmB,CAAC,IAAI,CAAC;IACzBF,eAAe,CAAC,EAAE,CAAC;IACnBJ,eAAe,CAAC,EAAE,CAAC;IACnBY,aAAa,CAAC+C,UAAU,CAAC;IAEzB,MAAMC,YAAY,GAAGD,UAAU,GAAG,CAACjE,aAAa,EAAEiE,UAAU,CAAC/D,GAAG,CAAC,CAACkC,IAAI,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC,GAAG,uBAAuB;IAC5GjB,eAAe,CAAC2C,IAAI,KAAK;MAAE,GAAGA,IAAI;MAAE,CAACG,YAAY,GAAG;IAAE,CAAC,CAAC,CAAC;EAE7D,CAAC,EAAE,CAAClE,aAAa,CAAC,CAAC;EAEnB,MAAMmE,iBAAiB,GAAGA,CAAA,KAAM;IAC5BvC,cAAc,CAAC,cAAc,CAAC;IAC9BV,aAAa,CAAC,IAAI,CAAC;IACnBV,cAAc,CAAC,EAAE,CAAC;EACtB,CAAC;;EAED;EACArD,SAAS,CAAC,MAAM;IACZ,IAAI,CAACuC,IAAI,IAAI,CAACK,KAAK,EAAE;MACjBN,QAAQ,CAAC,QAAQ,CAAC;MAClB;IACJ;IACA,IAAIC,IAAI,IAAI,CAACsC,kBAAkB,CAACM,OAAO,EAAE;MACrCmB,mBAAmB,CAAC,CAAC;MACrBzB,kBAAkB,CAACM,OAAO,GAAG,IAAI;IACrC;EACJ,CAAC,EAAE,CAAC5C,IAAI,EAAEK,KAAK,EAAEN,QAAQ,EAAEgE,mBAAmB,CAAC,CAAC;;EAEhD;EACAtG,SAAS,CAAC,MAAM;IACZ,IAAI,CAAC6C,aAAa,IAAIiC,YAAY,KAAK,SAAS,IAAI,CAACM,MAAM,CAACG,SAAS,EAAE;IACvEH,MAAM,CAACI,IAAI,CAAC,WAAW,EAAEV,YAAY,CAAC;IACtCkB,aAAa,CAAC,CAAC;EACnB,CAAC,EAAE,CAACnD,aAAa,EAAEiC,YAAY,EAAEM,MAAM,EAAEY,aAAa,EAAEZ,MAAM,CAACG,SAAS,CAAC,CAAC;;EAE1E;EACAvF,SAAS,CAAC,MAAM;IACZ,IAAI,CAACuC,IAAI,IAAI,CAACK,KAAK,EAAE;MAAE;IAAQ;IAE/BwC,MAAM,CAACK,EAAE,CAAC,oBAAoB,EAAGU,IAAI,IAAK;MACtChC,eAAe,CAACyC,IAAI,KAAK;QAAE,GAAGA,IAAI;QAAE,CAACT,IAAI,CAACc,MAAM,GAAGd,IAAI,CAACe;MAAS,CAAC,CAAC,CAAC;MACpE,IAAI,CAACf,IAAI,CAACe,QAAQ,IAAIf,IAAI,CAACQ,UAAU,EAAE;QACnCtC,eAAe,CAACuC,IAAI,KAAK;UAAE,GAAGA,IAAI;UAAE,CAACT,IAAI,CAACc,MAAM,GAAGd,IAAI,CAACQ;QAAW,CAAC,CAAC,CAAC;MAC1E;IACJ,CAAC,CAAC;IAEFvB,MAAM,CAACK,EAAE,CAAC,iBAAiB,EAAGU,IAAI,IAAK;MAAA,IAAAgB,YAAA;MACnC,MAAMC,aAAa,GAAGjB,IAAI,CAACkB,MAAM;MACjC,MAAMC,UAAU,GAAG,EAAAH,YAAA,GAAAhB,IAAI,CAACoB,MAAM,cAAAJ,YAAA,uBAAXA,YAAA,CAAapE,GAAG,MAAKF,aAAa;MAErD,IAAIuE,aAAa,KAAKxC,eAAe,CAACO,OAAO,EAAE;QAAA,IAAAqC,aAAA;QAC3C;QACA,MAAMC,UAAU,GAAG;UACf,GAAGtB,IAAI;UACPoB,MAAM,EAAE,CAAAC,aAAA,GAAArB,IAAI,CAACoB,MAAM,cAAAC,aAAA,eAAXA,aAAA,CAAazE,GAAG,GAAGoD,IAAI,CAACoB,MAAM,GAAG;YAAEG,IAAI,EAAEvB,IAAI,CAACwB,UAAU;YAAE5E,GAAG,EAAEoD,IAAI,CAACyB;UAAS;QACzF,CAAC;QACDvE,cAAc,CAAEwE,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEJ,UAAU,CAAC,CAAC;QAC/ClE,eAAe,CAAC,EAAE,CAAC;;QAEnB;QACA;;QAEAU,eAAe,CAAC2C,IAAI,KAAK;UAAE,GAAGA,IAAI;UAAE,CAACQ,aAAa,GAAG;QAAE,CAAC,CAAC,CAAC;MAC9D,CAAC,MAAM,IAAI,CAACE,UAAU,EAAE;QACpB;QACAlG,qBAAqB,CAAC,CAAC;QACvB6C,eAAe,CAAC2C,IAAI,KAAK;UACrB,GAAGA,IAAI;UACP,CAACQ,aAAa,GAAG,CAACR,IAAI,CAACQ,aAAa,CAAC,IAAI,CAAC,IAAI;QAClD,CAAC,CAAC,CAAC;MACP;IACJ,CAAC,CAAC;IAEFhC,MAAM,CAACK,EAAE,CAAC,eAAe,EAAGU,IAAI,IAAK;MACjC,IAAItD,aAAa,IAAIsD,IAAI,CAAC2B,QAAQ,IAAI3B,IAAI,CAACyB,QAAQ,KAAK/E,aAAa,IAAIsD,IAAI,CAACkB,MAAM,KAAKzC,eAAe,CAACO,OAAO,EAAE;QAC9G5B,eAAe,CAAC,GAAG4C,IAAI,CAACwB,UAAU,eAAe,CAAC;MACtD,CAAC,MAAM,IAAIxB,IAAI,CAACkB,MAAM,KAAKzC,eAAe,CAACO,OAAO,EAAE;QAChD5B,eAAe,CAAC,EAAE,CAAC;MACvB;IACJ,CAAC,CAAC;IAEF6B,MAAM,CAACK,EAAE,CAAC,gBAAgB,EAAGU,IAAI,IAAK;MAClC,IAAIA,IAAI,CAACkB,MAAM,KAAKzC,eAAe,CAACO,OAAO,EAAE;QACzC9B,cAAc,CAACwE,IAAI,IAAIA,IAAI,CAACE,GAAG,CAACC,GAAG,IAC/BA,GAAG,CAACjF,GAAG,KAAKoD,IAAI,CAAC8B,SAAS,GAAG;UAAE,GAAGD,GAAG;UAAEE,OAAO,EAAE/B,IAAI,CAACgC,UAAU;UAAEC,MAAM,EAAE;QAAK,CAAC,GAAGJ,GACtF,CAAC,CAAC;MACN;IACJ,CAAC,CAAC;IAEF5C,MAAM,CAACK,EAAE,CAAC,iBAAiB,EAAGU,IAAI,IAAK;MACnC,IAAIA,IAAI,CAACkB,MAAM,KAAKzC,eAAe,CAACO,OAAO,IAAIgB,IAAI,CAACkC,iBAAiB,EAAE;QACnEhF,cAAc,CAACwE,IAAI,IAAIA,IAAI,CAAC7C,MAAM,CAACgD,GAAG,IAAIA,GAAG,CAACjF,GAAG,KAAKoD,IAAI,CAAC8B,SAAS,CAAC,CAAC;MAC1E;IACJ,CAAC,CAAC;IAEF,OAAO,MAAM;MACT7C,MAAM,CAACM,GAAG,CAAC,iBAAiB,CAAC;MAC7BN,MAAM,CAACM,GAAG,CAAC,eAAe,CAAC;MAC3BN,MAAM,CAACM,GAAG,CAAC,gBAAgB,CAAC;MAC5BN,MAAM,CAACM,GAAG,CAAC,iBAAiB,CAAC;MAC7BN,MAAM,CAACM,GAAG,CAAC,oBAAoB,CAAC;IACpC,CAAC;EACL,CAAC,EAAE,CAACnD,IAAI,EAAEK,KAAK,EAAEwC,MAAM,EAAEvC,aAAa,EAAEiB,UAAU,CAAC,CAAC;;EAGpD;EACA,MAAMwE,SAAS,GAAGA,CAAA,KAAM/D,cAAc,CAAC,IAAI,CAAC;EAC5C,MAAMgE,UAAU,GAAGA,CAAA,KAAMhE,cAAc,CAAC,KAAK,CAAC;EAE9C,MAAMiE,oBAAoB,GAAGA,CAAA,KAAM;IAC/BlC,mBAAmB,CAAC,CAAC;IACrBiC,UAAU,CAAC,CAAC;IACZ9D,cAAc,CAAC,cAAc,CAAC;EAClC,CAAC;;EAED;;EAEAzE,SAAS,CAAC,MAAM;IAAA,IAAAyI,qBAAA;IACZ,CAAAA,qBAAA,GAAA/D,cAAc,CAACS,OAAO,cAAAsD,qBAAA,uBAAtBA,qBAAA,CAAwBC,cAAc,CAAC;MAAEC,QAAQ,EAAE;IAAS,CAAC,CAAC;EAClE,CAAC,EAAE,CAACvF,WAAW,CAAC,CAAC;EAEjB,MAAMwF,YAAY,GAAInH,CAAC,IAAK;IACxB0B,eAAe,CAAC1B,CAAC,CAACoH,MAAM,CAACC,KAAK,CAAC;IAC/B,IAAI,CAACjG,aAAa,EAAE;IAEpBuC,MAAM,CAACI,IAAI,CAAC,QAAQ,EAAE;MAAE6B,MAAM,EAAEvC,YAAY;MAAE8C,QAAQ,EAAE/E,aAAa;MAAE8E,UAAU,EAAEpF,IAAI,CAACmF,IAAI;MAAEI,QAAQ,EAAE;IAAK,CAAC,CAAC;IAE/G,IAAInD,gBAAgB,CAACQ,OAAO,EAAE;MAAE4D,YAAY,CAACpE,gBAAgB,CAACQ,OAAO,CAAC;IAAE;IAExER,gBAAgB,CAACQ,OAAO,GAAG6D,UAAU,CAAC,MAAM;MACxC5D,MAAM,CAACI,IAAI,CAAC,QAAQ,EAAE;QAAE6B,MAAM,EAAEvC,YAAY;QAAE8C,QAAQ,EAAE/E,aAAa;QAAE8E,UAAU,EAAEpF,IAAI,CAACmF,IAAI;QAAEI,QAAQ,EAAE;MAAM,CAAC,CAAC;IACpH,CAAC,EAAE,IAAI,CAAC;EACZ,CAAC;EAED,MAAMmB,eAAe,GAAG,MAAAA,CAAA,KAAY;IAChC,IAAI,CAAC/F,YAAY,CAACgG,IAAI,CAAC,CAAC,EAAE;IAE1B,MAAMC,gBAAgB,GAAGjG,YAAY,CAACgG,IAAI,CAAC,CAAC,CAACE,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC;IAClEjG,eAAe,CAAC,EAAE,CAAC;IAEnB,IAAI;MACA,MAAM8C,GAAG,GAAG,MAAM5F,KAAK,CAACgJ,IAAI,CAAC,GAAGnI,OAAO,OAAO,EAAE;QAAEmG,MAAM,EAAEvC,YAAY;QAAEoD,OAAO,EAAEiB;MAAiB,CAAC,EAAEvD,cAAc,CAAC,CAAC,CAAC;MAEtH,MAAM0D,aAAa,GAAG;QAAE,GAAGrD,GAAG,CAACE,IAAI;QAAEkB,MAAM,EAAEvC;MAAa,CAAC;MAE3DzB,cAAc,CAACwE,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEyB,aAAa,CAAC,CAAC;MAChDlE,MAAM,CAACI,IAAI,CAAC,cAAc,EAAE8D,aAAa,CAAC;IAE9C,CAAC,CAAC,OAAOlD,GAAG,EAAE;MAAA,IAAAmD,aAAA;MACV7H,OAAO,CAAC2E,KAAK,CAAC,8BAA8B,EAAE,EAAAkD,aAAA,GAAAnD,GAAG,CAACoD,QAAQ,cAAAD,aAAA,uBAAZA,aAAA,CAAcpD,IAAI,KAAIC,GAAG,CAACqD,OAAO,CAAC;MAChFtG,eAAe,CAACgG,gBAAgB,CAACC,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;IAC3D;EACJ,CAAC;EAED,MAAMM,eAAe,GAAG,MAAAA,CAAOC,IAAI,EAAEC,IAAI,KAAK;IAC1C,IAAI,CAAC/G,aAAa,IAAI,CAAC8G,IAAI,EAAE;IAE7B,MAAME,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;IAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEJ,IAAI,CAAC;IAC7BE,QAAQ,CAACE,MAAM,CAAC,QAAQ,EAAEjF,YAAY,CAAC;IACvC+E,QAAQ,CAACE,MAAM,CAAC,MAAM,EAAEH,IAAI,CAAC;IAE7B,IAAI;MACA,MAAM3D,GAAG,GAAG,MAAM5F,KAAK,CAACgJ,IAAI,CAAC,GAAGnI,OAAO,SAAS,EAAE2I,QAAQ,EAAEjE,cAAc,CAAC,IAAI,CAAC,CAAC;MAEjF,MAAM0D,aAAa,GAAG;QAAE,GAAGrD,GAAG,CAACE,IAAI;QAAEkB,MAAM,EAAEvC;MAAa,CAAC;MAE3DzB,cAAc,CAACwE,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEyB,aAAa,CAAC,CAAC;MAChDlE,MAAM,CAACI,IAAI,CAAC,cAAc,EAAE8D,aAAa,CAAC;IAE9C,CAAC,CAAC,OAAOlD,GAAG,EAAE;MAAA,IAAA4D,cAAA;MACVtI,OAAO,CAAC2E,KAAK,CAAC,8BAA8B,EAAE,EAAA2D,cAAA,GAAA5D,GAAG,CAACoD,QAAQ,cAAAQ,cAAA,uBAAZA,cAAA,CAAc7D,IAAI,KAAIC,GAAG,CAACqD,OAAO,CAAC;MAChFQ,KAAK,CAAC,qBAAqB,CAAC;IAChC;EACJ,CAAC;;EAED;EACA,MAAMC,gBAAgB,GAAIzI,CAAC,IAAK;IAC5B,MAAMkI,IAAI,GAAGlI,CAAC,CAACoH,MAAM,CAACsB,KAAK,CAAC,CAAC,CAAC;IAC9B,IAAI,CAACR,IAAI,EAAE;IAEX,IAAIC,IAAI;IACR,MAAMQ,QAAQ,GAAGT,IAAI,CAACC,IAAI;IAE1B,IAAIQ,QAAQ,CAACC,UAAU,CAAC,QAAQ,CAAC,EAAE;MAC/BT,IAAI,GAAG,OAAO;IAClB,CAAC,MAAM,IAAIQ,QAAQ,KAAK,iBAAiB,EAAE;MACvCR,IAAI,GAAG,KAAK;MAChB;IACA,CAAC,MAAM,IAAIQ,QAAQ,KAAK,yCAAyC,IACtDA,QAAQ,KAAK,oBAAoB,IACjCA,QAAQ,KAAK,yEAAyE,IACtFA,QAAQ,KAAK,0BAA0B,IACvCA,QAAQ,KAAK,mEAAmE,EAAE;MACxFR,IAAI,GAAG,UAAU;IACtB,CAAC,MAAM;MACH;MACAA,IAAI,GAAG,UAAU;IACrB;;IAEA;IACA,MAAMU,aAAa,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC;IACxC,IAAIX,IAAI,CAACY,IAAI,GAAGD,aAAa,EAAE;MAC3BL,KAAK,CAAC,sCAAsC,CAAC;MAC7CxI,CAAC,CAACoH,MAAM,CAACC,KAAK,GAAG,IAAI;MACrB;IACJ;IAEAY,eAAe,CAACC,IAAI,EAAEC,IAAI,CAAC;IAC3BnI,CAAC,CAACoH,MAAM,CAACC,KAAK,GAAG,IAAI;EACzB,CAAC;EAED,MAAM0B,eAAe,GAAIf,OAAO,IAAK;IACjChG,mBAAmB,CAACgG,OAAO,CAAC1G,GAAG,CAAC;IAChCY,gBAAgB,CAAC8F,OAAO,CAACvB,OAAO,CAACkB,OAAO,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;EAC3D,CAAC;EAED,MAAMqB,cAAc,GAAG,MAAOxC,SAAS,IAAK;IACxC,IAAI,CAACvE,aAAa,CAACwF,IAAI,CAAC,CAAC,EAAE;IAE3B,MAAMwB,sBAAsB,GAAGhH,aAAa,CAACwF,IAAI,CAAC,CAAC,CAACE,OAAO,CAAC,KAAK,EAAE,KAAK,CAAC;IAEzE,IAAI;MACA,MAAM/I,KAAK,CAACsK,GAAG,CAAC,GAAGzJ,OAAO,IAAI+G,SAAS,EAAE,EAAE;QAAEC,OAAO,EAAEwC;MAAuB,CAAC,EAAE9E,cAAc,CAAC,CAAC,CAAC;MAEjGvC,cAAc,CAACwE,IAAI,IAAIA,IAAI,CAACE,GAAG,CAACC,GAAG,IAC/BA,GAAG,CAACjF,GAAG,KAAKkF,SAAS,GAAG;QAAE,GAAGD,GAAG;QAAEE,OAAO,EAAEwC,sBAAsB;QAAEtC,MAAM,EAAE;MAAK,CAAC,GAAGJ,GACxF,CAAC,CAAC;MAEF5C,MAAM,CAACI,IAAI,CAAC,cAAc,EAAE;QAAEyC,SAAS;QAAEZ,MAAM,EAAEvC,YAAY;QAAEqD,UAAU,EAAEuC;MAAuB,CAAC,CAAC;MAEpGjH,mBAAmB,CAAC,IAAI,CAAC;MACzBE,gBAAgB,CAAC,EAAE,CAAC;IACxB,CAAC,CAAC,OAAOyC,GAAG,EAAE;MACV1E,OAAO,CAAC2E,KAAK,CAAC,sBAAsB,EAAED,GAAG,CAAC;IAC9C;EACJ,CAAC;EAED,MAAMwE,iBAAiB,GAAG,MAAAA,CAAO3C,SAAS,EAAEI,iBAAiB,KAAK;IAC9D,IAAI,CAACwC,MAAM,CAACC,OAAO,CAAC,gDAAgDzC,iBAAiB,GAAG,cAAc,GAAG,cAAc,GAAG,CAAC,EAAE;MACzH;IACJ;IAEA,IAAI;MACA,MAAMhI,KAAK,CAAC0K,MAAM,CAAC,GAAG7J,OAAO,IAAI+G,SAAS,EAAE,EAAE;QAC1C,GAAGrC,cAAc,CAAC,CAAC;QACnBO,IAAI,EAAE;UAAEkC,iBAAiB;UAAEhB,MAAM,EAAEvC;QAAa;MACpD,CAAC,CAAC;MAEF,IAAI,CAACuD,iBAAiB,EAAE;QACpBhF,cAAc,CAACwE,IAAI,IAAIA,IAAI,CAAC7C,MAAM,CAACgD,GAAG,IAAIA,GAAG,CAACjF,GAAG,KAAKkF,SAAS,CAAC,CAAC;MACrE;MACA;IACJ,CAAC,CAAC,OAAO7B,GAAG,EAAE;MACV1E,OAAO,CAAC2E,KAAK,CAAC,2BAA2B,EAAED,GAAG,CAAC;IACnD;EACJ,CAAC;;EAED;EACA,MAAM4E,oBAAoB,GAAIhD,GAAG,IAAK;IAClC,MAAME,OAAO,GAAGF,GAAG,CAACE,OAAO,IAAIF,GAAG,CAACiD,OAAO;IAE1C,MAAMC,cAAc,GAAIlD,GAAG,CAAC4B,IAAI,KAAK,MAAM,IAAI1B,OAAO,GAChDA,OAAO,CAACkB,OAAO,CAAC,MAAM,EAAE,OAAO,CAAC,GAChClB,OAAO;IAEb,MAAMiD,OAAO,GAAGjD,OAAO,CAACmC,UAAU,CAAC,WAAW,CAAC,GAAG,GAAGpJ,UAAU,GAAGiH,OAAO,EAAE,GAAGA,OAAO;IAErF,IAAIF,GAAG,CAAC4B,IAAI,KAAK,OAAO,EAAE;MACtB;MACA,oBAAOlJ,OAAA;QAAK0K,GAAG,EAAED,OAAQ;QAACE,GAAG,EAAC,cAAc;QAACC,SAAS,EAAC;MAAY;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC;IAC1E;IAEA,MAAMH,QAAQ,GAAGrD,OAAO,CAACyD,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC;IAEzC,IAAI5D,GAAG,CAAC4B,IAAI,KAAK,KAAK,EAAE;MACnB,oBAAOlJ,OAAA;QAAGmL,IAAI,EAAEV,OAAQ;QAACtC,MAAM,EAAC,QAAQ;QAACiD,GAAG,EAAC,qBAAqB;QAACR,SAAS,EAAC,6BAA6B;QAAAS,QAAA,gBACvGrL,OAAA;UAAM4K,SAAS,EAAC,WAAW;UAAAS,QAAA,EAAC;QAAO;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,KAAC,EAACH,QAAQ;MAAA;QAAAA,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACrD,CAAC;IACR;IAEA,IAAI1D,GAAG,CAAC4B,IAAI,KAAK,UAAU,EAAE;MACzB,oBAAOlJ,OAAA;QAAGmL,IAAI,EAAEV,OAAQ;QAACtC,MAAM,EAAC,QAAQ;QAACiD,GAAG,EAAC,qBAAqB;QAACR,SAAS,EAAC,oBAAoB;QAAAS,QAAA,gBAC7FrL,OAAA;UAAM4K,SAAS,EAAC,WAAW;UAAAS,QAAA,EAAC;QAAQ;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,KAAC,EAACH,QAAQ;MAAA;QAAAA,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACtD,CAAC;IACR;IAEA,oBAAOhL,OAAA;MAAKsL,uBAAuB,EAAE;QAAEC,MAAM,EAAEf;MAAe;IAAE;MAAAK,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EACvE,CAAC;EAED,IAAI,CAACnJ,IAAI,IAAI,CAACM,aAAa,EAAE;IAAE,oBAAOnC,OAAA;MAAAqL,QAAA,EAAK;IAAuB;MAAAR,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC;EAAE;EAE1E,oBACIhL,OAAA,CAAAE,SAAA;IAAAmL,QAAA,gBACIrL,OAAA;MAAK4K,SAAS,EAAC,oBAAoB;MAAAS,QAAA,gBAC/BrL,OAAA;QAAK4K,SAAS,EAAC,cAAc;QAAAS,QAAA,gBACzBrL,OAAA;UAAAqL,QAAA,EAAI;QAAkB;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eAC3BhL,OAAA;UAAG4K,SAAS,EAAC,kBAAkB;UAAAS,QAAA,GAAC,iBAAe,EAACxJ,IAAI,CAACmF,IAAI,EAAC,IAAE;QAAA;UAAA6D,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC,eAChEhL,OAAA;UAAA6K,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,EAGL1I,OAAO,iBACJtC,OAAA;UACI4K,SAAS,EAAE,+BAA+B9G,WAAW,KAAK,cAAc,GAAG,QAAQ,GAAG,EAAE,EAAG;UAC3F0H,OAAO,EAAElF,iBAAkB;UAAA+E,QAAA,gBAE3BrL,OAAA;YAAM4K,SAAS,EAAC,WAAW;YAAAS,QAAA,EAAC;UAAG;YAAAR,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC,eACtChL,OAAA;YAAK4K,SAAS,EAAC,WAAW;YAAAS,QAAA,eACtBrL,OAAA;cAAG4K,SAAS,EAAC,WAAW;cAAAS,QAAA,EAAC;YAAgB;cAAAR,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAG;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC5C,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL,CACR,eAEDhL,OAAA;UAAK4K,SAAS,EAAC,WAAW;UAAAS,QAAA,gBAEtBrL,OAAA;YACI4K,SAAS,EAAE,aAAa,CAACxH,UAAU,IAAIU,WAAW,KAAK,MAAM,GAAG,QAAQ,GAAG,EAAE,EAAG;YAChF0H,OAAO,EAAEA,CAAA,KAAMrF,gBAAgB,CAAC,IAAI,CAAE;YAAAkF,QAAA,gBAEtCrL,OAAA;cAAM4K,SAAS,EAAC,WAAW;cAAAS,QAAA,EAAC;YAAE;cAAAR,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACrChL,OAAA;cAAK4K,SAAS,EAAC,WAAW;cAAAS,QAAA,eACtBrL,OAAA;gBAAG4K,SAAS,EAAC,WAAW;gBAAAS,QAAA,EAAC;cAAsB;gBAAAR,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAG;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAClD,CAAC,EACL1H,YAAY,CAAC,uBAAuB,CAAC,GAAG,CAAC,iBACtCtD,OAAA;cAAM4K,SAAS,EAAC,cAAc;cAAAS,QAAA,EAAE/H,YAAY,CAAC,uBAAuB;YAAC;cAAAuH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAC/E;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACA,CAAC,EAEL9H,cAAc,CAACmE,GAAG,CAACoE,MAAM,IAAI;YAC1B,MAAMC,cAAc,GAAG,CAACvJ,aAAa,EAAEsJ,MAAM,CAACpJ,GAAG,CAAC,CAACkC,IAAI,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;YACnE,MAAMmH,KAAK,GAAGrI,YAAY,CAACoI,cAAc,CAAC,IAAI,CAAC;YAC/C,MAAMlF,QAAQ,GAAGhD,YAAY,CAACiI,MAAM,CAACpJ,GAAG,CAAC;YAEzC,oBACIrC,OAAA;cAEI4K,SAAS,EAAE,aAAa,CAAAxH,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEf,GAAG,MAAKoJ,MAAM,CAACpJ,GAAG,IAAIyB,WAAW,KAAK,MAAM,GAAG,QAAQ,GAAG,EAAE,EAAG;cACnG0H,OAAO,EAAEA,CAAA,KAAMrF,gBAAgB,CAACsF,MAAM,CAAE;cAAAJ,QAAA,gBAExCrL,OAAA;gBAAM4K,SAAS,EAAE,8BAA8BpE,QAAQ,GAAG,QAAQ,GAAG,SAAS,EAAG;gBAAA6E,QAAA,EAAC;cAAE;gBAAAR,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC,eAC3FhL,OAAA;gBAAK4K,SAAS,EAAC,WAAW;gBAAAS,QAAA,gBACtBrL,OAAA;kBAAG4K,SAAS,EAAC,WAAW;kBAAAS,QAAA,GAAC,IAAE,EAACI,MAAM,CAACzE,IAAI,EAAC,IAAE;gBAAA;kBAAA6D,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAG,CAAC,eAC9ChL,OAAA;kBAAO4K,SAAS,EAAC,aAAa;kBAAAS,QAAA,EAAE7E,QAAQ,GAAG,QAAQ,GAAG;gBAAS;kBAAAqE,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAQ,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACvE,CAAC,EACLW,KAAK,GAAG,CAAC,iBACN3L,OAAA;gBAAM4K,SAAS,EAAC,cAAc;gBAAAS,QAAA,EAAEM;cAAK;gBAAAd,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAO,CAC/C;YAAA,GAXIS,MAAM,CAACpJ,GAAG;cAAAwI,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAYd,CAAC;UAEd,CAAC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACD,CAAC,EAEL1I,OAAO,iBACJtC,OAAA;UACI4K,SAAS,EAAC,uBAAuB;UACjCY,OAAO,EAAE5D,SAAU;UAAAyD,QAAA,EAAC;QAExB;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CACX,eAEDhL,OAAA;UACI4K,SAAS,EAAC,eAAe;UACzBY,OAAO,EAAEA,CAAA,KAAM;YACXxJ,YAAY,CAAC4J,KAAK,CAAC,CAAC;YACpBlH,MAAM,CAACO,UAAU,CAAC,CAAC;YACnBrD,QAAQ,CAAC,QAAQ,CAAC;UACtB,CAAE;UAAAyJ,QAAA,EAAC;QAEP;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACR,CAAC,eAENhL,OAAA;QAAK4K,SAAS,EAAC,gBAAgB;QAAAS,QAAA,EAC1BvH,WAAW,KAAK,MAAM,gBACnB9D,OAAA,CAAAE,SAAA;UAAAmL,QAAA,gBAEIrL,OAAA;YAAK4K,SAAS,EAAC,aAAa;YAAAS,QAAA,gBACxBrL,OAAA;cAAAqL,QAAA,GAAI,kBAAgB,EAACjI,UAAU,GAAGA,UAAU,CAAC4D,IAAI,GAAG,oBAAoB,EAAC,IAAE;YAAA;cAAA6D,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI,CAAC,EAC/E5H,UAAU,iBACPpD,OAAA;cAAO4K,SAAS,EAAC,oBAAoB;cAAAS,QAAA,EAChC7H,YAAY,CAACJ,UAAU,CAACf,GAAG,CAAC,gBACzBrC,OAAA;gBAAM4K,SAAS,EAAC,eAAe;gBAAAS,QAAA,EAAC;cAAM;gBAAAR,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC,gBAE7ChL,OAAA;gBAAM4K,SAAS,EAAC,gBAAgB;gBAAAS,QAAA,EAC3BnK,cAAc,CAACwC,YAAY,CAACN,UAAU,CAACf,GAAG,CAAC,IAAIe,UAAU,CAAC6C,UAAU;cAAC;gBAAA4E,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACpE;YACT;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CACV;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACA,CAAC,eAENhL,OAAA;YAAK4K,SAAS,EAAC,cAAc;YAAAS,QAAA,GACxB3I,WAAW,CAAC2E,GAAG,CAAC,CAACC,GAAG,EAAEuE,KAAK,KAAK;cAAA,IAAAC,WAAA,EAAAC,YAAA,EAAAC,YAAA;cAC7B,MAAM/E,UAAU,GAAG,EAAA6E,WAAA,GAAAxE,GAAG,CAACT,MAAM,cAAAiF,WAAA,uBAAVA,WAAA,CAAY9E,IAAI,KAAI,QAAQ;cAC/C,MAAMJ,UAAU,GAAG,CAAC,EAAAmF,YAAA,GAAAzE,GAAG,CAACT,MAAM,cAAAkF,YAAA,uBAAVA,YAAA,CAAY1J,GAAG,OAAA2J,YAAA,GAAI1E,GAAG,CAACT,MAAM,cAAAmF,YAAA,uBAAVA,YAAA,CAAY5J,EAAE,OAAMD,aAAa;cAExE,oBACInC,OAAA;gBAA4B4K,SAAS,EAAE,0BAA0BhE,UAAU,GAAG,MAAM,GAAG,UAAU,EAAG;gBAAAyE,QAAA,eAChGrL,OAAA;kBAAK4K,SAAS,EAAC,gBAAgB;kBAAAS,QAAA,GAC1B,CAACzE,UAAU,iBAAI5G,OAAA;oBAAM4K,SAAS,EAAC,mBAAmB;oBAAAS,QAAA,EAAEpE;kBAAU;oBAAA4D,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAO,CAAC,eAEvEhL,OAAA;oBAAK4K,SAAS,EAAC,iBAAiB;oBAAAS,QAAA,EAE3BvI,gBAAgB,KAAKwE,GAAG,CAACjF,GAAG,IAAIuE,UAAU,gBACvC5G,OAAA;sBAAK4K,SAAS,EAAC,WAAW;sBAAAS,QAAA,gBACtBrL,OAAA;wBACIoI,KAAK,EAAEpF,aAAc;wBACrBiJ,QAAQ,EAAGlL,CAAC,IAAKkC,gBAAgB,CAAClC,CAAC,CAACoH,MAAM,CAACC,KAAK,CAAE;wBAClD8D,IAAI,EAAEC,IAAI,CAACC,GAAG,CAAC,EAAE,EAAEpJ,aAAa,CAACiI,KAAK,CAAC,IAAI,CAAC,CAACoB,MAAM,GAAG,CAAC;sBAAE;wBAAAxB,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAC5D,CAAC,eACFhL,OAAA;wBAAQwL,OAAO,EAAEA,CAAA,KAAMzB,cAAc,CAACzC,GAAG,CAACjF,GAAG,CAAE;wBAACiK,QAAQ,EAAE,CAACtJ,aAAa,CAACwF,IAAI,CAAC,CAAE;wBAAA6C,QAAA,EAAC;sBAAI;wBAAAR,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAQ,CAAC,eAC9FhL,OAAA;wBAAQwL,OAAO,EAAEA,CAAA,KAAMzI,mBAAmB,CAAC,IAAI,CAAE;wBAAAsI,QAAA,EAAC;sBAAM;wBAAAR,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAQ,CAAC;oBAAA;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAChE,CAAC,gBAENhL,OAAA,CAAAE,SAAA;sBAAAmL,QAAA,gBACIrL,OAAA;wBAAK4K,SAAS,EAAC,cAAc;wBAAAS,QAAA,GACxBf,oBAAoB,CAAChD,GAAG,CAAC,EACzBA,GAAG,CAACI,MAAM,iBAAI1H,OAAA;0BAAO4K,SAAS,EAAC,YAAY;0BAAAS,QAAA,EAAC;wBAAQ;0BAAAR,QAAA,EAAAC,YAAA;0BAAAC,UAAA;0BAAAC,YAAA;wBAAA,OAAO,CAAC;sBAAA;wBAAAH,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAC5D,CAAC,EACLpE,UAAU,iBACP5G,OAAA;wBAAK4K,SAAS,EAAC,kBAAkB;wBAAAS,QAAA,gBAC7BrL,OAAA;0BAAQwL,OAAO,EAAEA,CAAA,KAAM1B,eAAe,CAACxC,GAAG,CAAE;0BAACiF,KAAK,EAAC,MAAM;0BAAAlB,QAAA,EAAC;wBAAE;0BAAAR,QAAA,EAAAC,YAAA;0BAAAC,UAAA;0BAAAC,YAAA;wBAAA,OAAQ,CAAC,eACrEhL,OAAA;0BAAQwL,OAAO,EAAEA,CAAA,KAAMtB,iBAAiB,CAAC5C,GAAG,CAACjF,GAAG,EAAE,KAAK,CAAE;0BAACkK,KAAK,EAAC,oBAAoB;0BAAAlB,QAAA,EAAC;wBAAG;0BAAAR,QAAA,EAAAC,YAAA;0BAAAC,UAAA;0BAAAC,YAAA;wBAAA,OAAQ,CAAC,eACjGhL,OAAA;0BAAQwL,OAAO,EAAEA,CAAA,KAAMtB,iBAAiB,CAAC5C,GAAG,CAACjF,GAAG,EAAE,IAAI,CAAE;0BAACkK,KAAK,EAAC,qBAAqB;0BAAAlB,QAAA,EAAC;wBAAC;0BAAAR,QAAA,EAAAC,YAAA;0BAAAC,UAAA;0BAAAC,YAAA;wBAAA,OAAQ,CAAC;sBAAA;wBAAAH,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAC9F,CACR;oBAAA,eACH;kBACL;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACA,CAAC,eACNhL,OAAA;oBAAO4K,SAAS,EAAC,mBAAmB;oBAAAS,QAAA,EAC/B,IAAIhK,IAAI,CAACiG,GAAG,CAACnG,SAAS,CAAC,CAACG,kBAAkB,CAAC,EAAE,EAAE;sBAAEC,IAAI,EAAE,SAAS;sBAAEC,MAAM,EAAE;oBAAU,CAAC;kBAAC;oBAAAqJ,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACpF,CAAC;gBAAA;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACP;cAAC,GAnCA1D,GAAG,CAACjF,GAAG,IAAIwJ,KAAK;gBAAAhB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAoCrB,CAAC;YAEd,CAAC,CAAC,eACFhL,OAAA;cAAKwM,GAAG,EAAExI;YAAe;cAAA6G,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC3B,CAAC,eAENhL,OAAA;YAAK4K,SAAS,EAAC,cAAc;YAAAS,QAAA,gBACzBrL,OAAA;cAAK4K,SAAS,EAAC,eAAe;cAAAS,QAAA,EAAEzI;YAAY;cAAAiI,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACnDhL,OAAA;cAAK4K,SAAS,EAAC,YAAY;cAAAS,QAAA,gBACvBrL,OAAA;gBAAO4K,SAAS,EAAC,iBAAiB;gBAAAS,QAAA,GAAC,cAE/B,eAAArL,OAAA;kBAAOkJ,IAAI,EAAC,MAAM;kBAAC+C,QAAQ,EAAEzC,gBAAiB;kBAACiD,KAAK,EAAE;oBAACC,OAAO,EAAE;kBAAM;gBAAE;kBAAA7B,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACxE,CAAC,eAERhL,OAAA;gBACIkJ,IAAI,EAAC,MAAM;gBACXyD,WAAW,EAAC,mBAAmB;gBAC/BvE,KAAK,EAAE5F,YAAa;gBACpByJ,QAAQ,EAAE/D,YAAa;gBACvB0E,SAAS,EAAG7L,CAAC,IAAK;kBAAE,IAAIA,CAAC,CAAC8L,GAAG,KAAK,OAAO,EAAEtE,eAAe,CAAC,CAAC;gBAAE,CAAE;gBAChEqC,SAAS,EAAC;cAAe;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAC5B,CAAC,eACFhL,OAAA;gBAAQwL,OAAO,EAAEjD,eAAgB;gBAAC+D,QAAQ,EAAE,CAAC9J,YAAY,CAACgG,IAAI,CAAC,CAAE;gBAACoC,SAAS,EAAC,UAAU;gBAAAS,QAAA,EAAC;cAAI;gBAAAR,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACnG,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACL,CAAC;QAAA,eACR,CAAC;QAAA;QAEH;QACAhL,OAAA;UAAK4K,SAAS,EAAC,uBAAuB;UAAAS,QAAA,eAClCrL,OAAA,CAACF,cAAc;YAAA+K,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACjB;MACR;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACA,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,EAELpH,WAAW,IAAItB,OAAO,iBACnBtC,OAAA,CAACH,kBAAkB;MACfiN,OAAO,EAAEjF,UAAW;MACpBkF,gBAAgB,EAAEjF;IAAqB;MAAA+C,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC1C,CACJ;EAAA,eACH,CAAC;AAEX,CAAC;AAACrJ,EAAA,CApjBID,IAAI;EAAA,QACW9B,WAAW;AAAA;AAAAoN,EAAA,GAD1BtL,IAAI;AAsjBV,eAAeA,IAAI;AAAC,IAAAsL,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}